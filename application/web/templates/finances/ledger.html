{% extends "base.html" %}
{% from "finances/finances-tabs.html" import finances_tabs %}

{% block tabs %}
    {{ finances_tabs("ledger") }}
{% endblock tabs %}

{% set active_route = "finances" %}

{% set title = "Ledger" %}

{% block body %}
    <div class="row">
        <div class="col-12 mb-3">
            <div class="card">
                {#                <div class="card-header">#}
                {#                    <h5 class="card-title mb-0"></h5>#}
                {#                </div>#}
                <div class="card-body">
                    <form action="#">
                        <div class="row">
                            <div class="col-12 col-lg-3 mb-3 mb-lg-0">
                                <div class="form-group">
                                    <label class="form-label" for="start">Start</label>
                                    <select class="form-select" id="start">
                                        <option value="">2025-10</option>
                                        <option value="">2025-09</option>
                                        <option value="">2025-08</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-12 col-lg-3 mb-3 mb-lg-0">
                                <div class="form-group">
                                    <label class="form-label" for="end">End</label>
                                    <select class="form-select" id="end">
                                        <option value="">2025-10</option>
                                        <option value="">2025-09</option>
                                        <option value="">2025-08</option>
                                    </select>
                                </div>
                            </div>


                            <div class="col-12 col-lg-3 d-flex">
                                <div class="form-group mt-auto">
                                    <!-- Example split danger button -->
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-outline-secondary">Filter</button>
                                        <button type="button"
                                                class="btn btn-outline-secondary dropdown-toggle dropdown-toggle-split"
                                                data-bs-toggle="dropdown" aria-expanded="false">
                                            <span class="visually-hidden">Toggle Dropdown</span>
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end">
                                            <li><a class="dropdown-item" href="#">Download CSV</a></li>

                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>

                </div>
            </div>
        </div>
    </div>



    <div class="row">
        <div class="col">
            <div class="table-responsive-sm">
                <table class="table table-hover" id="ledger">
                    <thead class="sticky-top">
                    <tr>
                        <th class="border-bottom-0" scope="col">ID</th>
                        <th class="border-bottom-0" scope="col">Date</th>
                        <th class="border-bottom-0" scope="col">Category</th>
                        <th class="border-bottom-0" scope="col">Description</th>
                        <th class="border-bottom-0" scope="col">Income</th>
                        <th class="border-bottom-0" scope="col">Expense</th>
                        <th class="border-bottom-0" scope="col">Balance</th>
                    </tr>
                    <tr>
                        {#                        todo#}
                        <td colspan="7" class="py-0" style="background: white; height: 2px;"></td>
                    </tr>
                    </thead>

                    <tbody>
                    {% for ledger_item in ledger_data.ledger_items %}
                        <tr>
                            <td>
                                {{ "%03d"|format(ledger_item.ledger_item_id) }}
                            </td>
                            <td>{{ ledger_item.ledger_item_date }}</td>
                            <td>
                                <span class="font-monospace text-muted">todo</span>
                            </td>
                            <td>
                                {{ ledger_item.description }}
                            </td>
                            <td class="font-monospace">
                                {% if ledger_item.ledger_item_type == LedgerItemTypeEnum.INCOME %}
                                    ${{ "{:,.2f}".format(ledger_item.amount) }}
                                {% endif %}
                            </td>
                            <td class="font-monospace">
                                {% if ledger_item.ledger_item_type == LedgerItemTypeEnum.EXPENSE %}
                                    ({{ "{:,.2f}".format(ledger_item.amount) }})
                                {% endif %}
                            </td>
                            <td class="font-monospace">
                                ${{ "{:,.2f}".format(ledger_item.balance) }}
                            </td>
                        </tr>
                    {% endfor %}


                    </tbody>
                    <tfoot>
                    <tr style="border-top: 5px solid white;">
                        <th scope="row" colspan="4">Total</th>
                        <td class="font-monospace fw-bold">
                            {{ "${:,.2f}".format(ledger_data.total_income) }}
                        </td>
                        <td class="font-monospace fw-bold">
                            ({{ "{:,.2f}".format(ledger_data.total_expense) }})
                        </td>
                        <td class="font-monospace fw-bold">
                            {% if ledger_data.ending_balance >= 0 %}
                                ${{ "{:,.2f}".format(ledger_data.ending_balance) }}
                            {% else %}
                                ({{ "{:,.2f}".format(ledger_data.ending_balance) }})
                            {% endif %}
                        </td>
                    </tr>
                    </tfoot>
                </table>

            </div>

        </div>
    </div>
{% endblock body %}